<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>The HTML5 Herald</title>
    <meta name="description" content="The HTML5 Herald">
    <meta name="author" content="SitePoint">

    <link rel="stylesheet" href="leaflet.css"/>
    <link rel="stylesheet" href="routing/dist/leaflet-routing-machine.css"/>
    <script src="leaflet.js"></script>
    <script src="routing/dist/leaflet-routing-machine.js"></script>

</head>

<body>
    <style>
        #map {
            height: 500px;
            width:90%;
        }
    </style>
    <div id="routing"></div>
    <div id="map"><img src="mapholderbg.png" alt="Map Image"></div>
    <div id="info" fromLat="23.75" fromLong="90.44" style="display:none"></div>
    <script>

        var info_div = document.getElementById("info");
        var routing_div = document.getElementById("routing");
        var fromLat = parseFloat(info_div.getAttribute('fromLat'));
        var fromLong = parseFloat(info_div.getAttribute('fromLong'));

        var toLat = fromLat;
        var toLong = fromLong;

        var mapOptions = {
        maxZoom: 16,
        zoomControl: false,
        worldCopyJump: true 
        }

        function createButton(text,container){
            var button = document.createElement("button");
            button.innerHTML = text;
            container.appendChild(button);
        }


        var my_map = function (toLat,toLong) {
            var map_id = 'map';
            var map = L.map(map_id,mapOptions);

            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://github.com/hridoymahmud71/">Hridoy Mahmud</a> with the help of <a href="https://www.liedman.net/leaflet-routing-machine">of leaflet routing machine</a> '
            }).addTo(map);

            map.locate({setView: true});


            var control =  L.Routing.control({
                waypoints: [
                    L.latLng(fromLat,fromLong),
                    L.latLng(toLat,toLong)
                ],
                routeWhileDragging: true,
                show: true,
                autoRoute: true,
                routeWhileDragging: true
            })
                .on('routingstart',function (e) {
                    routing_div.innerHTML  = "Finding the best route for you";
                })
                .on('routingerror', function (e) {
                    console.log(e);
                    routing_div.innerHTML  = "Route finding error";
                })
                .on('routesfound', function(e) {
                var routes = e.routes;
                    routing_div.innerHTML = 'Found ' + routes.length + ' route(s).';
            })
                .addTo(map);



            // ---------------------------------------------------------------

            /*function createButton(label, container) {
            var btn = L.DomUtil.create('button', '', container);
            btn.setAttribute('type', 'button');
            btn.innerHTML = label;
            return btn;
            }*/




            map.on('click', function(e) {

                var container = L.DomUtil.create('div'),
                startBtn = createButton('From', container),
                destBtn = createButton('To', container);

                L.popup()
                    .setContent(container)
                    .setLatLng(e.latlng)
                    .openOn(map);

                    L.DomEvent.on(startBtn, 'click', function() {
                        L.Routing.control.spliceWaypoints(0, 1, e.latlng);
                        map.closePopup();
                    });

                    L.DomEvent.on(destBtn, 'click', function() {
                        L.Routing.control.spliceWaypoints( L.Routing.control.getWaypoints().length - 1, 1, e.latlng);
                        map.closePopup();
                    });
            });           

            

            var ReversablePlan = L.Routing.Plan.extend({
                createGeocoders: function() {
                    var container = L.Routing.Plan.prototype.createGeocoders.call(this),
                        reverseButton = createButton('↑↓', container);
                    return container;
                }
            });


            // ------------------------------------------------------------------

            return map;
        }

        //----------------------------------------------------------

        //my_map();

        navigator.geolocation.getCurrentPosition(function(location) {
            if(location !== null &&  location !== undefined)
                toLat = location.coords.latitude;
                toLong = location.coords.longitude;
            my_map(toLat,toLong)
        },function () {
            my_map(toLat,toLong);
        });

        



    </script>
</body>


</html>